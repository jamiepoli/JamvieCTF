<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Vie ">
<meta name="description" content="Just in Time Maple Bacon played in NahamCon CTF 2022 this past weekend, which came as a surprise - we were fully planning on focusing our efforts onto AngstromCTF which overlapped, however, NahamCon CTF proved to be interesting and good-quality so a last-minute decision was made to participate in both. AngstromCTF is still underway, but in the awkward passage of time between my last week and weekend, I played in NahamCon CTF for a little bit of practice." />
<meta name="keywords" content=", writeups, web, sqli, ssti, csrf, arduino" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#0c0c0d" />
<link rel="canonical" href="https://jamvie.net/posts/2022/05/nahamcon-ctf-2022/" />
<link rel="apple-touch-icon" sizes="180x180" href="https://jamvie.net/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jamvie.net/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://jamvie.net/favicon-16x16.png">
<link rel="manifest" href="https://jamvie.net/site.webmanifest">
<link rel="mask-icon" href="https://jamvie.net/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">


    <title>
        
            NahamCon CTF 2022 :: Vie 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://jamvie.net/main.55b05dd58d44589850d58f17e8855430a3c787fcea183e7a04436f53c9c0e0a5.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://jamvie.net/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://jamvie.net/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://jamvie.net/favicon-16x16.png">
    <link rel="manifest" href="https://jamvie.net/site.webmanifest">
    <link rel="mask-icon" href="https://jamvie.net/safari-pinned-tab.svg" color="#0c0c0d">
    <link rel="shortcut icon" href="https://jamvie.net/favicon.ico">
    <meta name="msapplication-TileColor" content="#0c0c0d">
    <meta name="theme-color" content="">



<meta itemprop="name" content="NahamCon CTF 2022">
<meta itemprop="description" content="Just in Time Maple Bacon played in NahamCon CTF 2022 this past weekend, which came as a surprise - we were fully planning on focusing our efforts onto AngstromCTF which overlapped, however, NahamCon CTF proved to be interesting and good-quality so a last-minute decision was made to participate in both. AngstromCTF is still underway, but in the awkward passage of time between my last week and weekend, I played in NahamCon CTF for a little bit of practice."><meta itemprop="datePublished" content="2022-05-02T12:40:52-07:00" />
<meta itemprop="dateModified" content="2022-05-02T12:40:52-07:00" />
<meta itemprop="wordCount" content="1081"><meta itemprop="image" content="https://jamvie.net/img/V.png"/>
<meta itemprop="keywords" content="writeups,web,sqli,ssti,csrf,arduino," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jamvie.net/img/V.png"/>

<meta name="twitter:title" content="NahamCon CTF 2022"/>
<meta name="twitter:description" content="Just in Time Maple Bacon played in NahamCon CTF 2022 this past weekend, which came as a surprise - we were fully planning on focusing our efforts onto AngstromCTF which overlapped, however, NahamCon CTF proved to be interesting and good-quality so a last-minute decision was made to participate in both. AngstromCTF is still underway, but in the awkward passage of time between my last week and weekend, I played in NahamCon CTF for a little bit of practice."/>





    <meta property="article:section" content="writeups" />



    <meta property="article:published_time" content="2022-05-02 12:40:52 -0700 -0700" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://jamvie.net/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ echo &#39;hello&#39;</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#fd262d;
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://jamvie.net/about/">About Me</a></li><li><a href="https://jamvie.net/categories/">Categories</a></li><li><a href="https://jamvie.net/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-176711986-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>6 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://jamvie.net/posts/2022/05/nahamcon-ctf-2022/">NahamCon CTF 2022</a>
            </h1>
                <hr />
                <aside id="toc">
                <div class="toc-title">Table of Contents</div>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#just-in-time">Just in Time</a></li>
    <li><a href="#challenges">Challenges</a>
      <ul>
        <li><a href="#flaskmetal-alchemist-web">Flaskmetal Alchemist (Web)</a></li>
        <li><a href="#two-for-one-web">Two For One (Web)</a></li>
        <li><a href="#deafcon-web">Deafcon (Web)</a></li>
        <li><a href="#dweeno-hardwarerf">Dweeno (Hardware/RF)</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </aside>
                <hr />

            

            <div class="post-content">
                <h2 id="just-in-time">Just in Time</h2>
<p>Maple Bacon played in NahamCon CTF 2022 this past weekend, which came as a surprise - we were fully planning on focusing our efforts onto AngstromCTF which overlapped, however, NahamCon CTF proved to be interesting and good-quality so a last-minute decision was made to participate in both. AngstromCTF is still underway, but in the awkward passage of time between my last week and weekend, I played in NahamCon CTF for a little bit of practice.</p>
<h2 id="challenges">Challenges</h2>
<h3 id="flaskmetal-alchemist-web">Flaskmetal Alchemist (Web)</h3>
<p>Snoop around for a little bit and observe that the sqlalchemy libary version the app is using is 0.2, which is incredibly old. Google &ldquo;sqlalchemy/0.2&rdquo; specifically and you&rsquo;ll recieve a few <a href="https://security.snyk.io/vuln/SNYK-PYTHON-SQLALCHEMY-173678">hits</a> on a potential SQLi vulnerability in the group_by/order_by function. Luckily for us, the application indeed utilizes the <code>order_by</code> function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>            <span style="color:#a6e22e">metals</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Metal</span>.<span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">filter</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Metal</span>.<span style="color:#a6e22e">name</span>.<span style="color:#a6e22e">like</span>(<span style="color:#e6db74">&#34;%{}%&#34;</span>.<span style="color:#a6e22e">format</span>(<span style="color:#a6e22e">search</span>))
</span></span><span style="display:flex;"><span>            ).<span style="color:#a6e22e">order_by</span>(<span style="color:#a6e22e">text</span>(<span style="color:#a6e22e">order</span>))
</span></span></code></pre></div><p>Simply create an <code>ORDER BY</code>-based blind SQLi that changes the order of the elements as a boolean condition.</p>
<pre tabindex="0"><code>search=Li&amp;order=(CASE WHEN (SELECT HEX(SUBSTR(flag, 1, 1)) FROM flag)=&#34;66&#34; THEN atomic_number ELSE name END)
</code></pre><p>Repeat this in a script and grab the flag character by character.</p>
<p><code>flag{order_By_blind}</code></p>
<h3 id="two-for-one-web">Two For One (Web)</h3>
<p>The challenge is a pastebin-esque site but with added otp functionality for basically everything - from viewing and deleting notes, to changing your password.</p>
<p>With no source provided, snoop around and observe a feedback form in the settings tab. Play around with it and observe that it is vulnerable to XSS, whatever is submitted in the feedback form is rendered to an &ldquo;admin&rdquo; user.</p>
<p>We need 2 things: the admin&rsquo;s 2fa secret key and password. Start with the 2fa, since you need it for the password anyway.</p>
<p>In the settings page, observe a &ldquo;reset 2fa&rdquo; button which the server responds with an <code>otpauth</code> containing your username and a 2fa secret key.</p>
<pre tabindex="0"><code>otpauth://totp/Fort%20Knox:&lt;USER&gt;?secret=&lt;BUNCHOFLETTERSANDNUMBERS&gt;&amp;issuer=Fort%20Knox
</code></pre><p>Use the XSS functionality in the feedback form to send the admin to that endpoint and observe the 2fa secret key value that is returned - you now have the admin&rsquo;s 2fa (sidenote - it&rsquo;s good to have a <a href="https://totp.danhersam.com/">totp generator</a> handy for this occassion).</p>

    <img src="https://jamvie.net/images/nahamcon2022_twoforone_2fa.png"  alt="2fa gone bad"  class="center"  style="border-radius: 8px;"  />


<p>The next step is to retrieve their password, which you can do by again using the feedback form to send the admin to make a POST request to the <code>change_password</code> endpoint. The request will need a valid 2fa value alongside the new password, which you should have from before. Once you succesfully reset the admin&rsquo;s password, log into their account yourself and view their secret note.</p>

    <img src="https://jamvie.net/images/nahamcon2022_twoforone_flag.png"  alt="2fa gone bad"  class="center"  style="border-radius: 8px;"  />


<h3 id="deafcon-web">Deafcon (Web)</h3>
<p>The challenge asks for your name and email to be rendered onto a fake &ldquo;deaf con&rdquo; ticket as a PDF.</p>
<p>Observe that the ticket service has an alphanumeric whitelist on the name value, but does not have as strong of a restriction on the email value - only <code>()</code> chars are banned and the email must be RFC-compliant, which is easy to do by adding <code>@any.thing</code> at the end.</p>
<p>Script execution is possible, in a similar fashion to dangling markup. If you add an iframe or an img, the PDF will render it (albeit malformed). However, the service is also vulnerable to SSTI attacks, which can be tested by adding in a trivial payload such as <code>{{7*7}}</code> into the email field.</p>
<p>Craft an SSTI payload to find any file named <code>flag</code>.</p>
<h3 id="dweeno-hardwarerf">Dweeno (Hardware/RF)</h3>
<p>You&rsquo;re given a few things: <code>output.txt</code> which is a list of binary values, a <code>source.ino</code> file, an image of an arduino hooked up to a breadboard with a chip in the middle, and a sketch of the arduino as well.</p>

    <img src="https://jamvie.net/images/nahamcon2022_arduinosketch.png"  alt="arduino"  class="center"  style="border-radius: 8px;"  />


<p>Observe the sketch and note that the chip in the breadboard is a quad XOR 2-gate, hooked up to the input and output pins of the arduino. Observe the <code>source.ino</code> file:</p>
<pre tabindex="0"><code>char * flag = &#34;REDACTED&#34;;
String curr, first, second;
int in1=29, in2=27, in3=25, in4=23;
int out1=53, out2=51, out3=49, out4=47;
int i;

String get_output(String bits) {
    String output;
    digitalWrite(out1, ((bits[0] == &#39;1&#39;)? HIGH : LOW));
    digitalWrite(out2, ((bits[1] == &#39;1&#39;)? HIGH : LOW));
    digitalWrite(out3, ((bits[2] == &#39;1&#39;)? HIGH : LOW));
    digitalWrite(out4, ((bits[3] == &#39;1&#39;)? HIGH : LOW));
    delay(1000);
    output += String(digitalRead(in1));
    output += String(digitalRead(in2));
    output += String(digitalRead(in3));
    output += String(digitalRead(in4));
    return output;
}

//converts a given number into binary
String binary(int number) {
  String r;
  while(number!=0) {
    r = (number % 2 == 0 ? &#34;0&#34; : &#34;1&#34;)+r; 
    number /= 2;
  }
  while ((int) r.length() &lt; 8) {
    r = &#34;0&#34;+r;
  }
  return r;
}

void setup() {
  i = 0;
  pinMode(out1, OUTPUT);
  pinMode(out2, OUTPUT);
  pinMode(out3, OUTPUT);
  pinMode(out4, OUTPUT);
  pinMode(in1, INPUT);
  pinMode(in2, INPUT);
  pinMode(in3, INPUT);
  pinMode(in4, INPUT);
  Serial.begin(9600);
}

void loop() {
  if (i &lt; strlen(flag)) {
    curr = binary(flag[i]);
    first = curr.substring(0,4);
    second = curr.substring(4,8);
    Serial.print(get_output(first));
    Serial.println(get_output(second));
    delay(1000);
    i++;
  }
}
</code></pre><p>Of note in the code is the <code>loop()</code> function and <code>get_output()</code> function. The <code>loop()</code> iterates through each character in the global <code>flag</code> variable, then splits it in half and feeds both halves to <code>get_output()</code>.</p>
<p>The <code>get_output</code> function first calls to the arduino hardware and sets the 4 output pins to either a high voltage (HIGH) or low voltage (LOW) based on the value of a specific bit recieved in the input. Basically, it sets the output pins to either a 0 or 1 based on one of the bits in the input.
After a short delay, the function then reads the value from the input pins, which, recalling the sketch of the arduino, would have been hooked up with the output pins to a quad XOR gate. THerefore, the input pins would return either a 0 or 1 depending on the XOR operation.</p>
<p>To summarize, the functionality of dweeno is to simply XOR the bits of the flag sequentially. We still need to figure out what the output pins are being XOR&rsquo;ed with to get the value of the input pins - however, we know that the output.txt spits out the XOR&rsquo;ed flag. We can move backwards by determining that the first binary value in the output.txt file is the XOR&rsquo;ed character <code>f</code>. XOR&rsquo;ing the binary value of <code>f</code> with the output.txt values will return to us the key used to XOR the output pins - this is revealed to be <code>01010101</code>. Through reverse-engineering this small program, we can perform the necessary XOR operations to retrieve the flag with a simple script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>xor_boi <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;01010101&#34;</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>binary_flag <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;output.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> fp:
</span></span><span style="display:flex;"><span>	output <span style="color:#f92672">=</span> fp<span style="color:#f92672">.</span>readline()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> output:
</span></span><span style="display:flex;"><span>		curr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>			y <span style="color:#f92672">=</span> int(output[i],<span style="color:#ae81ff">2</span>) <span style="color:#f92672">^</span> int(xor_boi[i],<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>			curr <span style="color:#f92672">+=</span> str(y)
</span></span><span style="display:flex;"><span>		ascii_char <span style="color:#f92672">=</span> chr(int(curr,<span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>		flag <span style="color:#f92672">+=</span> ascii_char
</span></span><span style="display:flex;"><span>		output <span style="color:#f92672">=</span> fp<span style="color:#f92672">.</span>readline()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(flag)
</span></span></code></pre></div>
            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://jamvie.net/tags/writeups">writeups</a></span><span class="tag"><a href="https://jamvie.net/tags/web">web</a></span><span class="tag"><a href="https://jamvie.net/tags/sqli">sqli</a></span><span class="tag"><a href="https://jamvie.net/tags/ssti">ssti</a></span><span class="tag"><a href="https://jamvie.net/tags/csrf">csrf</a></span><span class="tag"><a href="https://jamvie.net/tags/arduino">arduino</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1081 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2022-05-02 13:40 -0600</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h"></span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://jamvie.net/posts/2022/08/defcon-30-retrospective/">
                                <span class="button__icon">←</span>
                                <span class="button__text">DEFCON 30: Retrospective</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="https://jamvie.net/posts/2022/04/b01lers-ctf-2022-hacker/place/">
                                <span class="button__text">B01lers CTF 2022: hacker/place</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            
                <span><a href="https://jamvie.net">Vie</a></span>
            
            <span>CC Attribution-NonCommercial 4.0 International License</span>
            <span> <a href="https://jamvie.net/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://jamvie.net/bundle.min.188af889e916d7182e7bf4af7bed9ff4c9b70dd61a69188cb044d25745a4ffc32b82cbec846336503520a7716e619cb46848931205cfa3176a691ff9152d4947.js" integrity="sha512-GIr4iekW1xgue/Sve&#43;2f9Mm3DdYaaRiMsETSV0Wk/8MrgsvshGM2UDUgp3FuYZy0aEiTEgXPoxdqaR/5FS1JRw=="></script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-176711986-1', 'auto');
	
	ga('send', 'pageview');
}
</script>



    </body>
</html>

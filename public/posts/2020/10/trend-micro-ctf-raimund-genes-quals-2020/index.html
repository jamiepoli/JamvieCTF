<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Jamie Polintan ">
<meta name="description" content="Last year, before I became an active participant in Maple Bacon, the team went on to participate in and land a top 10 position in Trend Micro 2019 Qualifiers, later going on to compete in the finals of that year. When the 2020 serving came up this weekend, I wanted to keep with tradition and maintain the pattern - and so we landed a top 10 position and will be going on ahead to the 2020 finals :)" />
<meta name="keywords" content=", reversing, android, OSINT, crypto" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#0c0c0d" />
<link rel="canonical" href="https://jamvie.net/posts/2020/10/trend-micro-ctf-raimund-genes-quals-2020/" />


    <title>
        
            Trend Micro CTF: Raimund Genes Quals 2020 :: Jam // Vie 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://jamvie.net/main.dede02da9537a98158079c023e83573e18127834838ef08172acce888341a797.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://jamvie.net/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://jamvie.net/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://jamvie.net/favicon-16x16.png">
    <link rel="manifest" href="https://jamvie.net/site.webmanifest">
    <link rel="mask-icon" href="https://jamvie.net/safari-pinned-tab.svg" color="#0c0c0d">
    <link rel="shortcut icon" href="https://jamvie.net/favicon.ico">
    <meta name="msapplication-TileColor" content="#0c0c0d">
    <meta name="theme-color" content="">



<meta itemprop="name" content="Trend Micro CTF: Raimund Genes Quals 2020">
<meta itemprop="description" content="Last year, before I became an active participant in Maple Bacon, the team went on to participate in and land a top 10 position in Trend Micro 2019 Qualifiers, later going on to compete in the finals of that year. When the 2020 serving came up this weekend, I wanted to keep with tradition and maintain the pattern - and so we landed a top 10 position and will be going on ahead to the 2020 finals :)">
<meta itemprop="datePublished" content="2020-10-04T13:12:06-06:00" />
<meta itemprop="dateModified" content="2020-10-04T13:12:06-06:00" />
<meta itemprop="wordCount" content="1686">
<meta itemprop="image" content="https://jamvie.net/img/front.png"/>



<meta itemprop="keywords" content="reversing,android,OSINT,crypto," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jamvie.net/img/front.png"/>

<meta name="twitter:title" content="Trend Micro CTF: Raimund Genes Quals 2020"/>
<meta name="twitter:description" content="Last year, before I became an active participant in Maple Bacon, the team went on to participate in and land a top 10 position in Trend Micro 2019 Qualifiers, later going on to compete in the finals of that year. When the 2020 serving came up this weekend, I wanted to keep with tradition and maintain the pattern - and so we landed a top 10 position and will be going on ahead to the 2020 finals :)"/>



    <meta property="og:title" content="Trend Micro CTF: Raimund Genes Quals 2020" />
<meta property="og:description" content="Last year, before I became an active participant in Maple Bacon, the team went on to participate in and land a top 10 position in Trend Micro 2019 Qualifiers, later going on to compete in the finals of that year. When the 2020 serving came up this weekend, I wanted to keep with tradition and maintain the pattern - and so we landed a top 10 position and will be going on ahead to the 2020 finals :)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jamvie.net/posts/2020/10/trend-micro-ctf-raimund-genes-quals-2020/" />
<meta property="og:image" content="https://jamvie.net/img/front.png"/>
<meta property="article:published_time" content="2020-10-04T13:12:06-06:00" />
<meta property="article:modified_time" content="2020-10-04T13:12:06-06:00" />






    <meta property="article:published_time" content="2020-10-04 13:12:06 -0600 MDT" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://jamvie.net/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ echo &#39;hello&#39;</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://jamvie.net/about/">About Me</a></li><li><a href="https://jamvie.net/tags/">Categories</a></li><li><a href="https://jamvie.net/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-176711986-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>8 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://jamvie.net/posts/2020/10/trend-micro-ctf-raimund-genes-quals-2020/">Trend Micro CTF: Raimund Genes Quals 2020</a>
            </h1>

            

            <div class="post-content">
                <p>Last year, before I became an active participant in Maple Bacon, the team went on to participate in and land a top 10 position in Trend Micro 2019 Qualifiers, later going on to compete in the finals of that year. When the 2020 serving came up this weekend, I wanted to keep with tradition and maintain the pattern - and so we landed a top 10 position and will be going on ahead to the 2020 finals :)</p>
<!-- raw HTML omitted -->
<p>During the event, I was focused on one problem alongside my teammate Arctic, our resident crypto expert. Special thanks to Robert as well for assisting me throughout the challenge! The problem we were focused on was the RF-Mobile challenge known as &ldquo;Keybox&rdquo;.</p>
<h2 id="lets-begin">Let&rsquo;s Begin!</h2>
<p>Keybox is an android app. The zip file of the challenge contained a single APK file, which I popped into android studio to poke around in, and used <code>jadx</code> to manually look through the files as well. In the APK, the <code>AndroidManifest.xml</code> file was far more informative than it regularly would be, defining several unique intents as well as new behaviour for other ones. The app itself, &ldquo;Keybox&rdquo;, was essentially a psuedo-spyware program - based on what you did while the app was open, it would listen in on any intents you made and act accordingly.</p>

    <img src="https://jamvie.net/images/AppView.png"  alt="AppView"  class="center"  style="border-radius: 8px;"  />


<p>The app itself was straightforward enough. The flag was in it, but encoded in rc4, with a specific key that was split across 5 values that themselves were encoded (also in rc4) with unique keys of their own. The idea was that you had to &ldquo;solve&rdquo; 5 levels in order to have the app decode the key fragment for you. There were hints (also encoded, but with the same key) that gave you a clue as to what to do to decrypt the key fragment. Once you decrypted all 5 keys, you combine it and use it as the key to decrypt the flag.</p>
<p>So, let&rsquo;s quickly review:</p>
<ul>
<li>
<p>the flag is encoded in rc4. The key for the flag&rsquo;s encoding algorithm is split into 5 other key bits.</p>
</li>
<li>
<p>those key bits are also encoded in rc4, each key bit having their own unique encoding key. However, there are hints as to how to unlock them.</p>
</li>
<li>
<p>those hints are encoded too. Luckily, the hints all share the same decryption key.</p>
</li>
</ul>
<p>Great! So we know nothing. Let&rsquo;s just jump into it.</p>
<h3 id="key-0">Key 0</h3>
<p>First up, key 0. The hint was already decoded for us:</p>

    <img src="https://jamvie.net/images/Key0Hints.png"  alt="Login"  class="center"  style="border-radius: 8px;"  />


<p>But the actual key bit itself was still unknown. So I poked around in the <code>AndroidManifest.xml</code> file and saw this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">       <span style="color:#f92672">&lt;activity</span>
            <span style="color:#a6e22e">android:theme=</span><span style="color:#e6db74">&#34;@ref/0x7f0e0008&#34;</span>
            <span style="color:#a6e22e">android:label=</span><span style="color:#e6db74">&#34;@ref/0x7f0d003a&#34;</span>
            <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;com.trendmicro.keybox.KEY1HintActivity&#34;</span>
            <span style="color:#a6e22e">android:exported=</span><span style="color:#e6db74">&#34;true&#34;</span>
            <span style="color:#a6e22e">android:hint=</span><span style="color:#e6db74">&#34;Unlocking the hints requires sending the appropriate intent : adb shell am start-activity -a com.trendmicro.keybox.UNLOCK_HINT -n com.trendmicro.keybox/.KEY1HintActivity -e hintkey1 $PASSWORD&#34;</span>
            <span style="color:#a6e22e">android:parentActivityName=</span><span style="color:#e6db74">&#34;com.trendmicro.keybox.KeyboxMainActivity&#34;</span><span style="color:#f92672">&gt;</span>

            <span style="color:#f92672">&lt;intent-filter&gt;</span>

                <span style="color:#f92672">&lt;action</span>
                    <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;com.trendmicro.keybox.UNLOCK_HINT&#34;</span> <span style="color:#f92672">/&gt;</span>

                <span style="color:#f92672">&lt;category</span>
                    <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;android.intent.category.LAUNCHER&#34;</span> <span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;/intent-filter&gt;</span>

            <span style="color:#f92672">&lt;meta-data</span>
                <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;android.support.PARENT_ACTIVITY&#34;</span>
                <span style="color:#a6e22e">android:value=</span><span style="color:#e6db74">&#34;com.trendmicro.keybox.KeyboxMainActivity&#34;</span> <span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;/activity&gt;</span>
        
</code></pre></div><p>This was to unlock the hint for key 1. It was an app-specific intent that required a password. The intent itself would actually decrypt the hint, with the password you provided it as the key (am I using &lsquo;key&rsquo; too much here?). Since the actual &ldquo;hint&rdquo; in key 0 didn&rsquo;t really deliver information to me about <em>how</em> to unlock key 0, I figured I would request the hint again. But I didn&rsquo;t know the password value(more on this later). So Arctic and I bounced a few ideas back and forth until I thought to sanity check and use the same password provided to us to unzip the challenge file.</p>

    <img src="https://jamvie.net/images/Key0Decrypt.png"  alt="Login"  class="center"  style="border-radius: 8px;"  />


<p>I&rsquo;m not sure why that worked. I&rsquo;m not totally sure this was intended or not. But regardless, the key for key 0&rsquo;s encryption process was the password that was used to unzip the challenge file. Later on, Arctic mentioned that the real hint for key 0 we maybe never found out, and we ended up just correctly guessing the key to decode key0.</p>
<h3 id="key-1">Key 1</h3>
<p>So on a bit of lucky streak, I continued on to key 1, while Arctic decrypted the hints. Because we still didn&rsquo;t know the encryption key for the hints, Arctic used a scoring function to decode as much of the hints in the ciphertexts as possible. The bits and pieces she recovered for key1&rsquo;s hint was:</p>
<pre><code>To unlock Key 1, you must call Trend Micro.
</code></pre><p>It was at this point that I was examining the other classes in the APK that I realized that the encryption key was hidden in the singleton class - <code>TrendMicro</code>.</p>
<p>Another teammate and mentor Robert quickly spun up a python script called <code>decrypt.py</code> to automate much of the decrypting process, now that we figured out the password.
But the full hint for key 1 didn&rsquo;t reveal anything else. That was the whole hint.</p>
<p>So now I had to look at and see how the app listens in for incoming and outgoing calls.</p>
<p>I spent a good portion of my time calling up all possible Trend Micro office numbers through my emulator, and simulating incoming calls from them, to no avail. And so I thought about it a bit more:</p>
<p>In the observer class in the APK file, they instantiated a listener to look for incoming calls (the CALL_STATE android intent). The hint suggested to call the office, but the code itself seemed to only be paying attention to incoming callers, not calls you make. Wether or not the intention was to do both, I thought about how this would work.</p>
<p>Since the app was listening in on call history, how would it then know when to decrypt KEY1? What is the encryption key it&rsquo;s looking for? Well, since the hint and the code all pointed to the act of making and recieving calls, then the encryption key to decode KEY1 must be a phone number. And wether or not I was having luck with dialing all possible offices to see if the app&rsquo;s listener would take notice, the components were all there. The encryption key had to be a phone number. We knew that KEY1 bit was encoded in rc4. So, couldn&rsquo;t we just take the .enc file and give it a couple Trend Micro phone numbers as a key, and run it through the rc4 decryption process?</p>
<p>It turned out that the phone number for Trend Micro&rsquo;s Japan HQ was the key to decrypt KEY1.</p>

    <img src="https://jamvie.net/images/key1Decrypt.png"  alt="Login"  class="center"  style="border-radius: 8px;"  />


<h3 id="key-2">Key 2</h3>
<p>With that being said, key 2 was way easier to decrypt. The hint for it was simple:</p>
<pre><code>To unlock KEY2, send the secret code.
</code></pre><p>Which is sufficiently vague, but &ldquo;secret codes&rdquo; are meaningful in Android developement.</p>
<p>Secret codes are specific sequences of numbers that could perform special actions. For example, the code <code>232338</code> would reveal your android phone&rsquo;s MAC address. Applications can also use them to perform secret tasks or unlock hidden features. If you wanted to test this out on your android device, open up your dialer and input a secret code as so:
<code>*#*#123456#*#*</code>.</p>
<p>In the <code>AndroidManifest.xml</code> file, the SECRET_CODE intent is defined:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">            <span style="color:#f92672">&lt;intent-filter&gt;</span>
                <span style="color:#f92672">&lt;action</span> <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;android.provider.Telephony.SECRET_CODE&#34;</span><span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;data</span> <span style="color:#a6e22e">android:host=</span><span style="color:#e6db74">&#34;\ 8736364276&#34;</span> <span style="color:#a6e22e">android:scheme=</span><span style="color:#e6db74">&#34;android_secret_code&#34;</span><span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;data</span> <span style="color:#a6e22e">android:host=</span><span style="color:#e6db74">&#34;\ 8736364275&#34;</span> <span style="color:#a6e22e">android:scheme=</span><span style="color:#e6db74">&#34;android_secret_code&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;/intent-filter&gt;</span>
</code></pre></div><p>So the secret code in the app is the encryption key for KEY2!</p>
<p>You can either use <code>abd</code> to send the <code>android.provider.Telephony.SECRET_CODE</code> intent or just use the dialer in the emulator, as the app has a listener on the call function. Either way, you get KEY2.</p>

    <img src="https://jamvie.net/images/Key2Decrypt.png"  alt="Login"  class="center"  style="border-radius: 8px;"  />


<h2 id="key-3">Key 3</h2>
<p>The hint for Key3 was:</p>
<pre><code>Unlock KEY3 by sending the right text message. 
</code></pre><p>This requires some explanation on the architecture of text messages in an android phone.</p>
<p>SMS messages are kept in a relational database - specifically, sqlite. In the APK&rsquo;s observer class, we see some interesting checking going on:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    invoke<span style="color:#f92672">-</span><span style="color:#66d9ef">interface</span> <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#a6e22e">v5</span><span style="color:#f92672">,</span> v2<span style="color:#f92672">},</span> Landroid<span style="color:#f92672">/</span>database<span style="color:#f92672">/</span>Cursor<span style="color:#f92672">;-&gt;</span>getColumnName<span style="color:#f92672">(</span>I<span style="color:#f92672">)</span>Ljava<span style="color:#f92672">/</span>lang<span style="color:#f92672">/</span>String<span style="color:#f92672">;</span>

    move<span style="color:#f92672">-</span>result<span style="color:#f92672">-</span>object v5

    invoke<span style="color:#f92672">-</span>virtual <span style="color:#f92672">{</span>v4<span style="color:#f92672">,</span> v5<span style="color:#f92672">},</span> Ljava<span style="color:#f92672">/</span>lang<span style="color:#f92672">/</span>String<span style="color:#f92672">;-&gt;</span>equals<span style="color:#f92672">(</span>Ljava<span style="color:#f92672">/</span>lang<span style="color:#f92672">/</span>Object<span style="color:#f92672">;)</span>Z

    move<span style="color:#f92672">-</span>result v4

    <span style="color:#66d9ef">if</span><span style="color:#f92672">-</span>eqz v4<span style="color:#f92672">,</span> <span style="color:#f92672">:</span>cond_a8

    iget<span style="color:#f92672">-</span>object v4<span style="color:#f92672">,</span> p0<span style="color:#f92672">,</span> Lcom<span style="color:#f92672">/</span>trendmicro<span style="color:#f92672">/</span>keybox<span style="color:#f92672">/</span>Observer<span style="color:#f92672">;-&gt;</span>cursor<span style="color:#f92672">:</span>Landroid<span style="color:#f92672">/</span>database<span style="color:#f92672">/</span>Cursor<span style="color:#f92672">;</span>

    iget<span style="color:#f92672">-</span>object v5<span style="color:#f92672">,</span> p0<span style="color:#f92672">,</span> Lcom<span style="color:#f92672">/</span>trendmicro<span style="color:#f92672">/</span>keybox<span style="color:#f92672">/</span>Observer<span style="color:#f92672">;-&gt;</span>cursor<span style="color:#f92672">:</span>Landroid<span style="color:#f92672">/</span>database<span style="color:#f92672">/</span>Cursor<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">const</span><span style="color:#f92672">-</span>string v6<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;type&#34;</span>

    invoke<span style="color:#f92672">-</span><span style="color:#66d9ef">interface</span> <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#a6e22e">v5</span><span style="color:#f92672">,</span> v6<span style="color:#f92672">},</span> Landroid<span style="color:#f92672">/</span>database<span style="color:#f92672">/</span>Cursor<span style="color:#f92672">;-&gt;</span>getColumnIndex<span style="color:#f92672">(</span>Ljava<span style="color:#f92672">/</span>lang<span style="color:#f92672">/</span>String<span style="color:#f92672">;)</span>I

    move<span style="color:#f92672">-</span>result v5

    invoke<span style="color:#f92672">-</span><span style="color:#66d9ef">interface</span> <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#a6e22e">v4</span><span style="color:#f92672">,</span> v5<span style="color:#f92672">},</span> Landroid<span style="color:#f92672">/</span>database<span style="color:#f92672">/</span>Cursor<span style="color:#f92672">;-&gt;</span>getInt<span style="color:#f92672">(</span>I<span style="color:#f92672">)</span>I
</code></pre></div><p>What&rsquo;s happening here? Well, long story short, when we send an SMS message, the app will access the SMS sqlite database and iterate through the columns of that database, and match the content of the text message to the column name. If there&rsquo;s a match, then the app will unlock the 3rd key for us. This must mean that the string needed to decrypt the third key bit must be one of the column names!</p>

    <img src="https://jamvie.net/images/Key3Decrypt.png"  alt="key3"  class="center"  style="border-radius: 8px;"  />


<p>The column name that decrypted KEY3 turned out to be &lsquo;body&rsquo;.</p>
<h2 id="key-4">Key 4</h2>
<p>Despite KEY4 having the longest hint, and arguably the most amount of time to do, KEY4 was remarkably simple. The details are in the function of the ciphertext:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// why actually calculate distance when you can just fake it ;)
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span>(Math.<span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">location_latitude</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">singleton_latitude</span>) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.001</span> <span style="color:#f92672">&amp;&amp;</span> Math.<span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">location_longitude</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">singleton_longitude</span>) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.001</span> ) {
            <span style="color:#a6e22e">Log</span>(<span style="color:#e6db74">&#34;Matched Location &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">location</span>);
            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">SHA1</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Hashes</span>.<span style="color:#a6e22e">SHA1</span>;
            <span style="color:#a6e22e">hash</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SHA1</span>.<span style="color:#a6e22e">hex</span>(<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">location</span>)
            <span style="color:#66d9ef">if</span>( <span style="color:#a6e22e">hash</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">hash</span>) {
                <span style="color:#a6e22e">location_match</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Welcome to &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">location</span>;
            } <span style="color:#66d9ef">else</span> {
                <span style="color:#a6e22e">location_match</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Welcome to &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">location</span>;
                <span style="color:#a6e22e">singleton</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">hash</span>);
            }
            <span style="color:#66d9ef">break</span>;
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#a6e22e">location_match</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
        }
    }


    <span style="color:#a6e22e">titleView</span>.<span style="color:#a6e22e">setText</span>(<span style="color:#e6db74">&#34;Key Four Hints&#34;</span>);
    <span style="color:#a6e22e">textView</span>.<span style="color:#a6e22e">setText</span>(
    <span style="color:#e6db74">&#34;Visit &#34;</span> <span style="color:#f92672">+</span> <span style="color:#75715e">/* all three of */</span> <span style="color:#e6db74">&#34;the headquarters to unlock Key 4&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n\n&#34;</span> <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">location_match</span>
    );

    <span style="color:#66d9ef">return</span>(<span style="color:#66d9ef">true</span>)<span style="color:#e6db74">`
</span></code></pre></div><p>The hint specified to visit only the 3 headquarters, which were in the USA, Canada and Japan (Irving, Ontario and Tokyo respectively). While you can simulate your location in the emulator to pretend as if you visited all 3 locations, what it was looking for was the hash of the lat-lon location. It would check if that hash was among the list of accepted ones (which are only the hashes of the 3 HQs), and then append those hashes and use it as the key to decrypt KEY4.</p>
<p>So, we needed to just append the hashes of the 3 headquarters, and input that as our decryption key to key4.enc.</p>

    <img src="https://jamvie.net/images/Key4Decrypt.png"  alt="Login"  class="center"  style="border-radius: 8px;"  />


<h2 id="the-flag">The Flag</h2>
<p>With all 5 keys decrypted, all that was left was to combine them all and decrypt the flag.</p>
<p><code>TMCTF{pzDbkfWGcE}</code></p>
<p>Special thanks to my teammates, rctcwyvern and Robert for helping me out :) I&rsquo;m thankful I spent my earlier CS years playing around in Android Studio. I unknowingly gained some valuable skills needed to reverse engineer the APK. Goes to show how every little thing counts! :P</p>
<h4 id="vie">Vie</h4>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://jamvie.net/tags/reversing">reversing</a></span><span class="tag"><a href="https://jamvie.net/tags/android">android</a></span><span class="tag"><a href="https://jamvie.net/tags/osint">OSINT</a></span><span class="tag"><a href="https://jamvie.net/tags/crypto">crypto</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1686 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-10-04 13:12 -0600</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h"></span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://jamvie.net/posts/2020/10/hack.lu-2020-confessions/">
                                <span class="button__icon">←</span>
                                <span class="button__text">Hack.lu 2020: Confessions</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="https://jamvie.net/posts/2020/09/volgactf-finals-2020/">
                                <span class="button__text">VolgaCTF Finals 2020</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="https://jamvie.net">Jamie Polintan</a></span>
            
            <span>CC Attribution-NonCommercial 4.0 International License</span>
            <span> <a href="https://jamvie.net/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://jamvie.net/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-176711986-1', 'auto');
	
	ga('send', 'pageview');
}
</script>




    </body>
</html>
